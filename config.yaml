# ==================== 基础设置 ====================
socks-port: 7891
mixed-port: 7890
tproxy-port: 9898
allow-lan: true
mode: rule
log-level: info
ipv6: false
external-controller: 0.0.0.0:9090
secret: ''
external-ui: ./dashboard

# ==================== 性能优化 ====================
tcp-concurrent: true
# 针对安卓 App，模拟原生指纹最稳
global-client-fingerprint: android
keep-alive-interval: 30

# ==================== DNS 设置 (防污染) ====================
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  
  # 代理域名直连解析
  fake-ip-filter: 
    - '+.arxlabs.io'
    - 'connect.rom.miui.com'

  default-nameserver: [223.5.5.5, 119.29.29.29]
  nameserver: 
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  fallback: 
    - https://dns.google/dns-query
    - https://1.1.1.1/dns-query
  
  fallback-filter: { geoip: true, ipcidr: [240.0.0.0/4] }

# ==================== Tun/TProxy 配合设置 ====================
tun:
  enable: false
  stack: gvisor
  auto-route: true
  auto-detect-interface: true
  dns-hijack: [any:53]
  mtu: 1280
  # 强制指定 IP 防止 172.19 泄露
  inet4-address: [198.18.0.1/30]

# ==================== 节点列表 ====================
proxies:
  # 1. 中转基座 (Trojan)
  - {"name":"中转线路HK03","type":"trojan","server":"203.198.28.164","port":56303,"password":"4abbaf42-b2bd-4c63-ac65-d753f4c05dbf","skip-cert-verify":true,"udp":true,"IsBase":true}
  - {"name":"中转线路香港K40","type":"trojan","server":"203.198.28.164","port":56303,"IsBase":true,"password":"4abbaf42-b2bd-4c63-ac65-d753f4c05dbf","skip-cert-verify":true,"udp":true}
  - {"name":"香港中转K40","type":"trojan","server":"203.198.28.164","port":56303,"IsBase":true,"password":"4abbaf42-b2bd-4c63-ac65-d753f4c05dbf","skip-cert-verify":true,"udp":true}

  # 2. 香港出口 (绑定中转)
  - {"name":"HK_061","type":"socks5","server":"us.arxlabs.io","port":3010,"region":"HK","username":"hmq88888-region-HK-sid-5m6AWGsB-t-110","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_091","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-UL6jbgF4-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_092","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-hCbZWTJN-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_093","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-ASYYhzZZ-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_094","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-cUemWQjM-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_095","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-1HhiLtPC-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_096","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-NCsWL9k6-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_097","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-JtM12dm1-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_098","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-dzvHhWeu-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_099","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-dC8GgwMJ-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
  - {"name":"HK_100","type":"socks5","server":"sg.arxlabs.io","port":443,"region":"HK","username":"hmq88888-region-HK-asn-AS4760-sid-Hv8vGFcn-t-80","password":"qaz123wsx","skip-cert-verify":true,"udp":true,"dialer-proxy":"中转线路HK03"}
 
# ==================== 策略组 ====================
proxy-groups:
  - name: "Select-HK-IP"
    type: select
    proxies:
      - "中转线路HK03"
      - "中转线路香港K40"
      - "HK_061"
      - "HK_091"
      - "HK_092"
      - "HK_093"
      - "HK_094"
      - "HK_095"
      - "HK_096"
      - "HK_097"
      - "HK_098"
      - "HK_099"
      - "HK_100"
      - "香港中转K40"
       
  - name: "PROXY"
    type: select
    proxies:
      - "Select-HK-IP"
       
# ==================== 规则 ====================
rules:
  # 1. 安全阻断
  - IP-CIDR6,::/0,REJECT,no-resolve
  - DST-PORT,3478,REJECT
  - DST-PORT,3479,REJECT
  # 强制 UDP 443 (QUIC) 阻断，让 Chrome 走 TCP
  - AND,((DST-PORT,443),(NETWORK,UDP)),REJECT
  
  # 2. Carousell 业务分流
  - DOMAIN-KEYWORD,carousell,Select-HK-IP
  - DOMAIN-SUFFIX,carousell.com,Select-HK-IP
  - DOMAIN-SUFFIX,carousell.com.hk,Select-HK-IP
  - DOMAIN-SUFFIX,media.carousell.com,Select-HK-IP
  
  # 3. Google/Android 服务 (确保不走国内)
  - DOMAIN-SUFFIX,googleapis.com,Select-HK-IP
  - DOMAIN-SUFFIX,gstatic.com,Select-HK-IP
  - DOMAIN-SUFFIX,google.com,Select-HK-IP
  
  # 4. 国内直连
  - GEOIP,CN,DIRECT
  - GEOSITE,CN,DIRECT
  
  # 5. 兜底
  - MATCH,Select-HK-IP
redir-port: 9797